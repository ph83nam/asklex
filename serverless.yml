service: lexofood
provider:
  name: aws
  runtime: nodejs6.10
  stage: ${opt:stage, self:custom.defaultStage}
  profile: ${self:custom.profiles.${self:provider.stage}}
  memorySize: 512 # Overwrite the default memory size. Default is 1024
  versionFunctions: false # Optional function versioning
  stackTags: # Optional CF stack tags
    name: lexofood-${self:provider.stage}
custom:
  defaultStage: dev
  profiles:
    dev: lexofood-dev
    prod: lexofood-prod
functions:
  usersCreate:
    handler: users/handler
    events:
      - http: post users
  usersGet:
    handler: users/handler.getUser
    events:
      - http: get users
  usersUpdate:
    handler: users/handler
    events:
      - http: put users
  usersDelete:
    handler: users/handler
    events:
      - http: delete users
  runCrawler:
    handler: takeaway/crawl.run
    events:
      - schedule: cron(30 0,6,12 * * ? *)
  saveRestaurant:
    handler: takeaway/restaurant.save
    events:
      - http: post takeaway/restaurants
  saveFood:
    handler: takeaway/food.save
    events:
      - http: post takeaway/foods
resources:
  Resources:
    usersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: usersTable
        AttributeDefinitions:
          - AttributeName: uid
            AttributeType: B
          #- AttributeName: firstName
          #  AttributeType: S
          #- AttributeName: lastName
          #  AttributeType: S
          #- AttributeName: sex
          #  AttributeType: S
          #- AttributeName: email
          #  AttributeType: S
          #- AttributeName: mobile
          #  AttributeType: S
          #- AttributeName: createdAt
          #  AttributeType: S
          #- AttributeName: updatedAt
          #  AttributeType: S
        KeySchema:
          - AttributeName: uid
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
    restaurantsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: restaurant
        AttributeDefinitions:
          - AttributeName: rid
            AttributeType: B
          #- AttributeName: name
          #  AttributeType: S
          #- AttributeName: status
          #  AttributeType: S
          #- AttributeName: phone
          #  AttributeType: S
          #- AttributeName: email
          #  AttributeType: S
          #- AttributeName: address
          #  AttributeType: S
          #- AttributeName: address2
          #  AttributeType: S
          #- AttributeName: locality
          #  AttributeType: S
          #- AttributeName: city
          #  AttributeType: S
          #- AttributeName: state
          #  AttributeType: S
          #- AttributeName: country
          #  AttributeType: S
          #- AttributeName: createdAt
          #  AttributeType: S
          #- AttributeName: updatedAt
          #  AttributeType: S
        KeySchema:
          - AttributeName: rid
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
    foodsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: foods
        AttributeDefinitions:
          - AttributeName: fid
            AttributeType: B
          - AttributeName: name
            AttributeType: S
          #- AttributeName: types
          #  AttributeType: SS
          #- AttributeName: images
          #  AttributeType: SS
          #- AttributeName: price
          #  AttributeType: N
          #- AttributeName: rating
          #  AttributeType: N
          #- AttributeName: available
          #  AttributeType: N
          #- AttributeName: createdAt
          #  AttributeType: S
          #- AttributeName: updatedAt
          #  AttributeType: S
        KeySchema:
          - AttributeName: fid
            KeyType: HASH
          - AttributeName: name
            KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
    foodTLsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: foodTLs
        AttributeDefinitions:
          - AttributeName: typeLocality
            AttributeType: B
          - AttributeName: fidName
            AttributeType: S
          #- AttributeName: price
          #  AttributeType: N
          #- AttributeName: rating
          #  AttributeType: N
        KeySchema:
          - AttributeName: typeLocality
            KeyType: HASH
          - AttributeName: fidName
            KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1